# Weekly Food Planner (WFP) - App Specification

## 1. App Overview

**Zweck**: Persoenliche Food-Tracking-App zum Erfassen von Mahlzeiten, Ueberwachen von Naehrwertzielen und Pflegen gesunder Ernaehrungsgewohnheiten.

**Zielgruppe**: Einzelnutzer (Sebastian), der taegliche Kalorienzufuhr und Makronaehrwerte tracken moechte.

**Plattform**: Web-App (PWA-faehig), Mobile-first, mit Desktop-Support.

**Sprache**: Deutsche UI-Labels.

**Tech-Stack**: React 18, TypeScript, TailwindCSS, Firebase (Auth + Firestore), React Router v6, React Query, Zustand.

---

## 2. Information Architecture

### Sitemap

```
App
├── Login (/login)
├── Registrierung (/register)
├── [Authentifiziert]
│   ├── Tagesplanung (/day-planning) ← Startseite
│   ├── Dashboard (/dashboard) ← Platzhalter "Coming soon"
│   ├── Gerichte (/dishes)
│   │   ├── Gerichte-Liste (/dishes)
│   │   ├── Neues Gericht (/dishes/new)
│   │   ├── Gericht bearbeiten (/dishes/:id/edit)
│   │   ├── Gericht aus Zutaten erstellen (/dishes/create-with-ingredients)
│   │   ├── Gericht-Zutaten bearbeiten (/dishes/:id/edit-ingredients)
│   │   └── Gericht importieren (/dishes/import)
│   ├── Porridge-Rechner (/porridge) [Feature-Flag]
│   ├── Profil (/profile)
│   └── Geteiltes Gericht (/shared-dish/:shareCode)
└── 404 Not Found (*)
```

### Navigation

- **Desktop**: Sticky Sidebar links mit Icon + Label pro Route
- **Mobile**: Sticky Header oben (Hamburger-Menu) + Fixed Bottom-Tab-Bar (4-5 Tabs)
- **Theme-Toggle**: Light/Dark Mode Umschalter in Sidebar/Header

---

## 3. Screen Inventory

### 3.1 Login

**Zweck**: Benutzer-Authentifizierung mit E-Mail und Passwort.

**UI-Elemente**:
- E-Mail Input-Feld
- Passwort Input-Feld
- Login-Button
- Link zu Registrierung

**User Actions**:
- E-Mail und Passwort eingeben
- Login absenden
- Zur Registrierung wechseln

**Daten**: Firebase Auth (email/password). Formularzustand wird in Zustand-Store persistiert.

---

### 3.2 Registrierung

**Zweck**: Neues Benutzerkonto erstellen.

**UI-Elemente**:
- E-Mail Input-Feld
- Passwort Input-Feld
- Registrieren-Button
- Link zu Login

**User Actions**:
- E-Mail und Passwort eingeben
- Registrierung absenden
- Zum Login wechseln

**Daten**: Firebase Auth Account-Erstellung.

---

### 3.3 Tagesplanung (Startseite)

**Zweck**: Kern-Screen der App. Tagesmahlzeiten planen, Naehrwerte tracken, Sport erfassen.

**UI-Elemente**:

*Kalender-Navigation:*
- Wochen-Kalender (7 Tage horizontal scrollbar)
- Vor/Zurueck-Pfeile fuer Wochenwechsel
- Aktiver Tag hervorgehoben
- Tage mit vorhandenem Mealplan markiert (Punkt/Indikator)

*Naehrwert-Uebersicht:*
- Kalorien-Card: Ring-Progress (gegessen vs. Ziel), verbrannte Kalorien
- Defizit-Card: Kalorien-Ueberschuss/Defizit-Berechnung
- Makro-Cards: Protein, Kohlenhydrate, Fett jeweils mit Ring-Progress

*Mahlzeit-Sektionen (je eine fuer Fruehstueck, Mittagessen, Abendessen, Snacks):*
- Sektions-Header mit Mahlzeit-Name
- Autocomplete-Suchfeld zum Hinzufuegen von Gerichten
- Liste hinzugefuegter Gerichte:
  - Gericht-Name
  - Kalorien-Anzeige
  - Mengen-Selector (Multiplikator: 0.25, 0.5, 0.75, 1, 1.25, 1.5, 2, etc.)
  - Entfernen-Button
  - Rezept-Toggle (aufklappbar)

*Sport-Sektion [Feature-Flag]:*
- Sport-Aktivitaeten Liste
- Beschreibung + verbrannte Kalorien pro Aktivitaet
- Hinzufuegen/Entfernen von Aktivitaeten
- Intervals.icu Sync-Button (laedt Aktivitaeten automatisch)

*Snacks & Extras:*
- Temporaere Mahlzeiten (einmalige Eintraege, nicht in Gerichte-Bibliothek)
- Beschreibung + Kalorien + Protein + Kohlenhydrate + Fett

*Magenbeschwerde-Tracker [Feature-Flag]:*
- Slider 0-10
- Emoji-Feedback je nach Stufe

*Tagesnotiz [Feature-Flag]:*
- Freitext-Feld fuer Notizen zum Tag

*Aktions-Buttons:*
- Speichern
- Loeschen (mit Bestaetigung)
- Zuruecksetzen (mit Bestaetigung)

**User Actions**:
- Tag im Kalender auswaehlen
- Gerichte suchen und zu Mahlzeiten hinzufuegen
- Menge anpassen
- Gerichte entfernen
- Rezept anzeigen
- Sport-Aktivitaeten hinzufuegen/entfernen/syncen
- Temporaere Mahlzeit hinzufuegen
- Magenbeschwerde-Level setzen
- Tagesnotiz schreiben
- Mealplan speichern/loeschen/zuruecksetzen

**Daten**:
- Liest: MealPlan (nach Datum), Dishes (fuer Autocomplete), NutritionGoals, WeeklyNutritionGoals, UserProfile (Feature-Flags)
- Schreibt: MealPlan (CRUD)

---

### 3.4 Dashboard

**Zweck**: Uebersicht und Statistiken (aktuell Platzhalter).

**UI-Elemente**:
- "Coming soon" Nachricht

**Status**: Nicht implementiert.

---

### 3.5 Gerichte-Liste

**Zweck**: Gerichte-Bibliothek durchsuchen, filtern und verwalten.

**UI-Elemente**:

*Filter-Bar:*
- Name-Suchfeld
- Kategorie-Filter (Fruehstueck, Hauptgericht, Snack)
- Kalorien-Range-Filter
- Protein-Range-Filter
- Kohlenhydrate-Range-Filter
- Fett-Range-Filter
- Bewertungs-Filter (Sterne)
- Sortierung (Name, Kalorien, Protein, Bewertung - aufsteigend/absteigend)

*Gerichte-Grid/Liste:*
- DishCards mit:
  - Gericht-Name
  - Kalorien, Protein, Kohlenhydrate, Fett
  - Kategorie-Badge
  - Sterne-Bewertung (interaktiv)
  - Bearbeiten-Button
  - Loeschen-Button (mit Bestaetigung)
  - Teilen-Button

*Aktionen:*
- "Neues Gericht" Button
- "Gericht aus Zutaten" Button
- "Gericht importieren" Button

**User Actions**:
- Filter setzen/zuruecksetzen
- Sortierung aendern
- Gericht bewerten (1-5 Sterne)
- Gericht bearbeiten (Navigation)
- Gericht loeschen
- Gericht teilen (Share-Dialog mit Code/Link)
- Neues Gericht erstellen (Navigation)

**Daten**:
- Liest: Alle Dishes des Users
- Schreibt: Dish löschen, Dish bewerten
- Persistiert: Filter-Einstellungen in localStorage

---

### 3.6 Neues Gericht / Gericht bearbeiten

**Zweck**: Manuelles Erstellen oder Bearbeiten eines Gerichts.

**UI-Elemente**:
- Name Input
- Kategorie Select (Fruehstueck, Hauptgericht, Snack)
- Kalorien Input (Zahl)
- Protein Input (Zahl)
- Kohlenhydrate Input (Zahl)
- Fett Input (Zahl)
- Rezept Textarea (optional)
- Rezept-URL Input (optional)
- KI-Scan Button: Foto von Naehrwerttabelle hochladen, Gemini extrahiert Werte automatisch
- Speichern-Button
- Abbrechen-Button

**User Actions**:
- Naehrwerte manuell eingeben
- Foto einer Naehrwerttabelle hochladen (KI-Erkennung)
- Rezept/URL hinterlegen
- Speichern oder abbrechen

**Daten**:
- Liest: Dish (bei Bearbeitung)
- Schreibt: Dish erstellen/aktualisieren
- Extern: Gemini API (Bilderkennung)

---

### 3.7 Gericht aus Zutaten erstellen / bearbeiten

**Zweck**: Gericht aus einzelnen Zutaten zusammenstellen mit automatischer Naehrwertberechnung.

**UI-Elemente**:
- Gericht-Name Input
- Kategorie Select
- Zutaten-Liste:
  - Zutat-Name (Autocomplete/Suche)
  - Menge Input
  - Einheit Select
  - Naehrwerte pro Einheit (automatisch befuellt)
  - Entfernen-Button
- Zutat hinzufuegen Button
- Barcode-Scanner / OpenFood Facts Suche
- Berechnete Gesamt-Naehrwerte (live aktualisiert)
- Speichern-Button

**User Actions**:
- Zutaten per Name suchen oder Barcode scannen
- Menge/Einheit pro Zutat anpassen
- Zutaten hinzufuegen/entfernen
- Gesamtnaehrwerte pruefen
- Als Gericht speichern

**Daten**:
- Liest: OpenFood Facts (Barcode/Suche)
- Schreibt: Dish mit ingredients[]

---

### 3.8 Gericht importieren

**Zweck**: Geteilte Gerichte von anderen Nutzern importieren.

**UI-Elemente**:
- Share-Code Input-Feld
- Import-Button
- Vorschau des geteilten Gerichts (Name, Naehrwerte)
- Bestaetigung-Button

**User Actions**:
- Share-Code eingeben oder Link oeffnen (/shared-dish/:shareCode)
- Gericht-Vorschau pruefen
- Import bestaetigen

**Daten**:
- Liest: SharedDish (per shareCode)
- Schreibt: Neues Dish in eigene Bibliothek (klont mit originalId-Referenz)

---

### 3.9 Porridge-Rechner [Feature-Flag]

**Zweck**: Spezialisierter Rechner fuer Porridge-Variationen mit vorkonfigurierten Zutaten.

**UI-Elemente**:
- Fluessigkeit: Typ-Select (Milch, Wasser, etc.) + Menge Input
- Haferflocken: Menge Input
- Erdnussbutter: Menge Input
- Whey Protein: Typ-Select + Menge Input
- Fruechte: Auswahl-Liste + Menge pro Frucht
- Live-Naehrwert-Berechnung (Kalorien, Protein, Kohlenhydrate, Fett)
- "Zum Mealplan hinzufuegen" Button
- "Als Gericht speichern" Button

**User Actions**:
- Zutaten-Mengen anpassen
- Naehrwerte in Echtzeit pruefen
- Direkt zum aktuellen Mealplan hinzufuegen
- Als wiederverwendbares Gericht speichern

**Daten**:
- Liest: Vorkonfigurierte Zutatenwerte (lokal)
- Schreibt: MealPlan (temporaere Mahlzeit) oder Dish

---

### 3.10 Profil

**Zweck**: Benutzereinstellungen und Naehrwertziele verwalten.

**UI-Elemente**:

*Naehrwertziele:*
- Basis-Kalorien Input
- Ziel-Kalorien Input
- Protein-Ziel Input (g)
- Kohlenhydrate-Ziel Input (g)
- Fett-Ziel Input (g)

*Woechentliche Ziele [Feature-Flag]:*
- Kalender-Wochenauswahl
- Woechentliche Naehrwertziele (gleiche Felder wie taeglich)

*Feature-Toggles:*
- Magenbeschwerde-Tracking ein/aus
- Woechentliche Ziele ein/aus
- Tagesnotiz ein/aus
- Sport-Tracking ein/aus
- Porridge-Rechner ein/aus
- Zutaten-basierter Gericht-Builder ein/aus

*Intervals.icu Integration:*
- API-Key Input
- Athlete-ID Input

*Account:*
- Logout-Button

**User Actions**:
- Naehrwertziele setzen/aendern
- Features aktivieren/deaktivieren
- Intervals.icu Credentials eingeben
- Ausloggen

**Daten**:
- Liest: UserProfile, NutritionGoals, WeeklyNutritionGoals
- Schreibt: UserProfile aktualisieren

---

## 4. Data Models

### Dish (Gericht)

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| id | string | Eindeutige ID |
| originalId | string? | Referenz bei importierten Gerichten |
| name | string | Gericht-Name |
| calories | number | Kalorien |
| protein | number? | Protein (g) |
| carbs | number? | Kohlenhydrate (g) |
| fat | number? | Fett (g) |
| recipe | string? | Rezept-Text |
| recipeUrl | string? | Link zum Rezept |
| category | enum? | "breakfast" / "mainDish" / "snack" |
| rating | number? | Bewertung 1-5 |
| ingredients | DishIngredient[]? | Zutaten-Liste |
| isIngredientBased | boolean? | Zutaten-basiert ja/nein |
| createdBy | string | User-ID |

### DishIngredient (Zutat)

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| name | string | Zutat-Name |
| barcode | string? | EAN-Barcode |
| quantity | number | Menge |
| unit | string | Einheit (g, ml, Stueck) |
| nutritionUnit | string | Bezugseinheit ("100g", "100ml", "1 Stueck") |
| caloriesPerUnit | number | Kalorien pro Bezugseinheit |
| proteinPerUnit | number | Protein pro Bezugseinheit |
| carbsPerUnit | number | Kohlenhydrate pro Bezugseinheit |
| fatPerUnit | number | Fett pro Bezugseinheit |
| sourceName | string? | Datenquelle |
| sourceUrl | string? | Link zur Datenquelle |

### MealPlan (Tagesplan)

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| id | string | Eindeutige ID |
| date | string | Datum "YYYY-MM-DD" |
| breakfast | Dish[] | Fruehstueck-Gerichte |
| lunch | Dish[] | Mittagessen-Gerichte |
| dinner | Dish[] | Abendessen-Gerichte |
| snacks | Dish[] | Snack-Gerichte |
| sports | SportActivity[] | Sport-Aktivitaeten |
| temporaryMeals | TemporaryMeal[] | Einmalige Mahlzeiten |
| dailyNote | string | Tagesnotiz |
| stomachPainLevel | number? | Magenbeschwerde 0-10 |
| createdBy | string | User-ID |
| createdAt | Date | Erstellt am |
| updatedAt | Date | Aktualisiert am |

### SportActivity

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| calories | number | Verbrannte Kalorien |
| description | string? | Beschreibung der Aktivitaet |
| intervalsId | string? | Intervals.icu Referenz |

### TemporaryMeal (Einmalige Mahlzeit)

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| description | string | Beschreibung |
| calories | number | Kalorien |
| protein | number | Protein (g) |
| carbs | number | Kohlenhydrate (g) |
| fat | number | Fett (g) |

### UserProfile

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| baseCalories | number? | Grundumsatz |
| targetCalories | number? | Ziel-Kalorien |
| protein | number? | Protein-Ziel (g) |
| carbs | number? | Kohlenhydrate-Ziel (g) |
| fat | number? | Fett-Ziel (g) |
| stomachPainTrackingEnabled | boolean? | Feature-Flag |
| weeklyNutritionGoalsEnabled | boolean? | Feature-Flag |
| dailyNoteEnabled | boolean? | Feature-Flag |
| sportEnabled | boolean? | Feature-Flag |
| porridgeCalculatorEnabled | boolean? | Feature-Flag |
| dishIngredientBuilderEnabled | boolean? | Feature-Flag |
| intervals.icu-API-KEY | string? | API-Key |
| intervals.icu-AthleteID | string? | Athlete-ID |

### WeeklyNutritionGoals

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| id | string? | Eindeutige ID |
| weekStartDate | string | Wochenstart-Datum |
| targetCalories | number? | Woechentliches Kalorien-Ziel |
| protein | number? | Protein-Ziel (g) |
| carbs | number? | Kohlenhydrate-Ziel (g) |
| fat | number? | Fett-Ziel (g) |
| createdBy | string | User-ID |

### SharedDish

| Feld | Typ | Beschreibung |
|------|-----|-------------|
| id | string | Eindeutige ID |
| dishId | string | Original Dish-ID |
| dish | Dish | Gericht-Kopie |
| sharedBy | string | User-ID |
| sharedByName | string | Username |
| shareCode | string | 6-stelliger Code |
| createdAt | Date | Erstellt am |
| expiresAt | Date | Ablaufdatum |

---

## 5. User Flows

### Flow 1: Tagesmahlzeit planen

1. User oeffnet App → Tagesplanung (Startseite)
2. Wochen-Kalender zeigt aktuelle Woche, heutiger Tag ist ausgewaehlt
3. Falls Mealplan fuer heute existiert → wird geladen und angezeigt
4. User tippt in Autocomplete-Feld einer Mahlzeit-Sektion
5. Gerichte werden nach Name gefiltert angezeigt
6. User waehlt Gericht aus → wird zur Mahlzeit hinzugefuegt
7. Optional: Menge anpassen (0.25x - 2x)
8. Naehrwert-Uebersicht aktualisiert sich live
9. User klickt "Speichern" → Mealplan wird in Firestore gespeichert

### Flow 2: Neues Gericht erstellen (manuell)

1. User navigiert zu Gerichte → "Neues Gericht"
2. Gibt Name, Kategorie und Naehrwerte ein
3. Optional: Foto einer Naehrwerttabelle hochladen → KI extrahiert Werte
4. Optional: Rezept-Text oder URL hinterlegen
5. Klickt "Speichern" → Gericht in Bibliothek gespeichert

### Flow 3: Gericht aus Zutaten erstellen

1. User navigiert zu Gerichte → "Aus Zutaten erstellen"
2. Gibt Gericht-Name und Kategorie ein
3. Fuegt Zutaten hinzu (Name suchen oder Barcode scannen)
4. OpenFood Facts liefert Naehrwerte pro Zutat
5. User passt Mengen an
6. Gesamtnaehrwerte werden live berechnet
7. Klickt "Speichern" → Gericht mit Zutaten-Liste gespeichert

### Flow 4: Gericht teilen und importieren

1. User A oeffnet Gericht → klickt "Teilen"
2. Share-Dialog zeigt Code und kopierbaren Link
3. User B oeffnet Link oder gibt Code auf Import-Seite ein
4. Vorschau des Gerichts wird angezeigt
5. User B bestaetigt Import → Gericht wird in eigene Bibliothek kopiert

### Flow 5: Sport-Tracking

1. User aktiviert Sport-Feature im Profil
2. In Tagesplanung erscheint Sport-Sektion
3. Manuell: Beschreibung + Kalorien eingeben
4. Automatisch: "Sync" laedt Intervals.icu Aktivitaeten (benoetigt API-Key)
5. Verbrannte Kalorien fliessen in Defizit-Berechnung ein

### Flow 6: Porridge-Rechner

1. User navigiert zu Porridge-Rechner
2. Waehlt Fluessigkeit, passt Mengen an
3. Naehrwerte werden live berechnet
4. Kann direkt zum Mealplan hinzugefuegt oder als Gericht gespeichert werden

---

## 6. Feature Flags

Folgende Features sind per User-Toggle im Profil ein-/ausschaltbar:

| Feature | Default | Beschreibung |
|---------|---------|-------------|
| Magenbeschwerde-Tracking | Aus | Slider in Tagesplanung |
| Woechentliche Naehrwertziele | Aus | Zusaetzliche Wochenziele im Profil |
| Tagesnotiz | Aus | Freitext-Feld in Tagesplanung |
| Sport-Tracking | Aus | Sport-Sektion in Tagesplanung |
| Porridge-Rechner | Aus | Eigener Navigations-Eintrag |
| Zutaten-basierter Builder | Aus | Zusaetzliche Gericht-Erstellungsoption |

Zusaetzlich gibt es ein Early-Access-System ueber eine erlaubte E-Mail-Liste.

---

## 7. External Integrations

### Firebase Authentication
- E-Mail/Passwort Login und Registrierung
- Auth-State Listener fuer Route Protection

### Firebase Firestore
- Primaere Datenbank fuer alle Entitaeten
- Collections: dishes, mealPlans, profiles, sharedDishes, weeklyNutritionGoals
- Echtzeit-Sync via onSnapshot

### Google Gemini 2.5 Flash
- KI-basierte Naehrwerterkennung aus Fotos von Naehrwerttabellen
- Wird in DishForm integriert

### OpenFood Facts API
- Barcode-Suche und Produkt-Lookup
- Liefert Naehrwertdaten pro Zutat
- Wird im Zutaten-basierten Gericht-Builder verwendet

### Intervals.icu API
- Sport-Aktivitaeten Sync
- Benoetigt API-Key und Athlete-ID (im Profil konfigurierbar)
- Liefert verbrannte Kalorien pro Aktivitaet

---

## 8. Design-Anforderungen fuer Pencil

- **Mobile-first**: Primaer fuer Smartphone-Nutzung optimiert
- **Komplett neues Design**: Freier kreativer Spielraum fuer Pencil
- **Alle Screens abdecken**: Login, Registrierung, Tagesplanung, Gerichte-Liste, Gericht erstellen/bearbeiten, Gericht aus Zutaten, Import, Porridge-Rechner, Profil
- **Navigation**: Bottom-Tab-Bar (Mobile), Sidebar (Desktop)
- **Dark Mode**: Unterstuetzung fuer Light und Dark Theme
- **Deutsche Labels**: Alle UI-Texte auf Deutsch
